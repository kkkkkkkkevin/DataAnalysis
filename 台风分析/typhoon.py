# -*- coding: utf-8 -*-
"""
Created on Wed Aug 21 20:43:55 2019

@author: Administrator
"""

from pymongo import MongoClient
import pandas as pd
import time
import datetime


# 显示所有列
pd.options.display.max_columns=None 
# 显示所有行
# pd.options.display.max_rows=None #显示所有行
conn=MongoClient('127.0.0.1', 27017)
db=conn.typhoon
data=pd.DataFrame(list(db['info'].find()))
begin_time=[]
end_time=[]
begin=[]
for i in data['begin_time']:
    begin_time.append(i.replace('T',' '))
    begin.append(int(i[5:7])*100+int(i[8:10]))
for i in data['end_time']:
    end_time.append(i.replace('T',' '))


def get_hour_delta(d1,d2):
    
    d1=datetime.datetime.strptime(d1, '%Y-%m-%d %H:%M:%S')
    d2=datetime.datetime.strptime(d2, '%Y-%m-%d %H:%M:%S')
    time_delta=d1 - d2
    hour_delta=time_delta.days*24+round(time_delta.seconds/3600)    
    return hour_delta

# print(get_hour_delta('2018-11-26 18:00:00','2018-11-23 20:00:00'))
hour_delta=[]
for i in range(len(begin_time)):
    hour_delta.append(get_hour_delta(end_time[i],begin_time[i]))

hour_delta=[delta for delta in hour_delta if delta<800]
avg_time_delta=sum(hour_delta)/len(hour_delta)

print(avg_time_delta) 
print(begin)
print(begin.index(max(begin)))
hour_delta=pd.Series(hour_delta)
data=pd.concat([data,hour_delta],axis=1)
print(data.columns)
data.columns=['_id', 'begin_time', 'ename', 'end_time', 'name', 'number','time_delta']
data.drop('_id',axis=1, inplace=True)

data=data[data['time_delta']<800]

              
min_time_delta_info=data[data['time_delta']==min(data['time_delta'])]
max_time_delta_info=data[data['time_delta']==max(data['time_delta'])]
print(min_time_delta_info)
print(max_time_delta_info)

data2=pd.DataFrame(list(db['detail'].find()))
min_latitude=data2[data2['latitude']==min(data2['latitude'])]
print(min_latitude)



list_year=list(range(1945,2019))

number=['201829', '201828', '201827', '201826', '201825', '201824', '201823', '201822', '201821', '201820', '201819', '201818', '201817', '201816', '201815', '201814', '201813', '201812', '201811', '201810', '201809', '201808', '201807', '201806', '201805', '201804', '201803', '201802', '201801', '201727', '201726', '201725', '201724', '201723', '201722', '201721', '201720', '201719', '201718', '201717', '201716', '201715', '201714', '201713', '201712', '201711', '201710', '201709', '201708', '201707', '201706', '201705', '201704', '201703', '201702', '201701', '201626', '201625', '201624', '201623', '201622', '201621', '201620', '201619', '201618', '201617', '201616', '201615', '201614', '201613', '201612', '201611', '201610', '201609', '201608', '201607', '201606', '201605', '201604', '201603', '201602', '201601', '201527', '201526', '201525', '201524', '201523', '201522', '201521', '201520', '201519', '201518', '201517', '201516', '201515', '201514', '201513', '201512', '201511', '201510', '201509', '201508', '201507', '201506', '201505', '201504', '201503', '201502', '201501', '201423', '201422', '201421', '201420', '201419', '201418', '201417', '201416', '201415', '201414', '201413', '201412', '201411', '201410', '201409', '201408', '201407', '201406', '201405', '201404', '201403', '201402', '201401', '201331', '201330', '201329', '201328', '201327', '201326', '201325', '201324', '201323', '201322', '201321', '201320', '201319', '201318', '201317', '201316', '201315', '201314', '201313', '201312', '201311', '201310', '201309', '201308', '201307', '201306', '201305', '201304', '201303', '201302', '201301', '201225', '201224', '201223', '201222', '201221', '201220', '201219', '201218', '201217', '201216', '201215', '201214', '201213', '201212', '201211', '201210', '201209', '201208', '201207', '201206', '201205', '201204', '201203', '201202', '201201', '201121', '201120', '201119', '201118', '201117', '201116', '201115', '201114', '201113', '201112', '201111', '201110', '201109', '201108', '201107', '201106', '201105', '201104', '201103', '201102', '201101', '201014', '201013', '201012', '201011', '201010', '201009', '201008', '201007', '201006', '201005', '201004', '201003', '201002', '201001', '200922', '200921', '200920', '200919', '200918', '200917', '200916', '200915', '200914', '200913', '200912', '200911', '200910', '200909', '200908', '200907', '200906', '200905', '200904', '200903', '200902', '200901', '200822', '200821', '200820', '200819', '200818', '200817', '200816', '200815', '200814', '200813', '200812', '200811', '200810', '200809', '200808', '200807', '200806', '200805', '200804', '200803', '200802', '200801', '200725', '200724', '200723', '200722', '200721', '200720', '200719', '200718', '200717', '200716', '200715', '200714', '200713', '200712', '200711', '200710', '200709', '200708', '200707', '200706', '200705', '200704', '200703', '200702', '200701', '200624', '200623', '200622', '200621', '200620', '200619', '200618', '200617', '200616', '200615', '200614', '200613', '200612', '200611', '200610', '200609', '200608', '200607', '200606', '200605', '200604', '200603', '200602', '200601', '200523', '200522', '200521', '200520', '200519', '200518', '200517', '200516', '200515', '200514', '200513', '200512', '200511', '200510', '200509', '200508', '200507', '200506', '200505', '200504', '200503', '200502', '200430', '200429', '200428', '200426', '200425', '200424', '200423', '200422', '200421', '200420', '200419', '200418', '200417', '200416', '200415', '200414', '200413', '200412', '200411', '200410', '200409', '200408', '200407', '200406', '200405', '200404', '200403', '200402', '200401', '200321', '200320', '200319', '200318', '200317', '200316', '200315', '200314', '200313', '200312', '200311', '200310', '200309', '200308', '200307', '200306', '200305', '200304', '200303', '200302', '200301', '200226', '200225', '200224', '200223', '200222', '200221', '200220', '200218', '200216', '200215', '200214', '200213', '200212', '200211', '200210', '200209', '200208', '200207', '200206', '200205', '200204', '200203', '200202', '200201', '200124', '200123', '200122', '200121', '200120', '200119', '200118', '200117', '200116', '200115', '200114', '200113', '200112', '200111', '200110', '200109', '200108', '200107', '200106', '200105', '200104', '200103', '200102', '200101', '200022', '200021', '200020', '200019', '200018', '200017', '200016', '200015', '200014', '200013', '200012', '200011', '200010', '200009', '200008', '200007', '200006', '200005', '200004', '200003', '200002', '200001', '199917', '199916', '199915', '199914', '199913', '199912', '199911', '199910', '199909', '199908', '199907', '199906', '199905', '199904', '199903', '199902', '199901', '199812', '199811', '199810', '199809', '199808', '199807', '199806', '199805', '199804', '199803', '199802', '199801', '199725', '199724', '199722', '199721', '199720', '199719', '199718', '199717', '199716', '199715', '199714', '199713', '199712', '199711', '199710', '199709', '199708', '199707', '199706', '199705', '199704', '199703', '199625', '199624', '199623', '199622', '199621', '199620', '199619', '199618', '199617', '199616', '199615', '199614', '199613', '199612', '199611', '199610', '199609', '199608', '199607', '199606', '199605', '199604', '199603', '199602', '199601', '199523', '199522', '199521', '199520', '199519', '199518', '199517', '199516', '199515', '199514', '199513', '199512', '199511', '199510', '199509', '199508', '199507', '199506', '199505', '199504', '199503', '199502', '199501', '199437', '199436', '199435', '199434', '199433', '199432', '199431', '199430', '199429', '199428', '199427', '199426', '199425', '199424', '199423', '199422', '199420', '199419', '199418', '199417', '199415', '199414', '199413', '199412', '199411', '199410', '199408', '199407', '199406', '199405', '199404', '199403', '199402', '199401', '199328', '199327', '199326', '199325', '199324', '199323', '199322', '199321', '199320', '199319', '199318', '199317', '199316', '199315', '199314', '199313', '199312', '199311', '199309', '199308', '199307', '199306', '199305', '199304', '199303', '199302', '199301', '199231', '199230', '199229', '199228', '199227', '199226', '199225', '199224', '199223', '199222', '199221', '199220', '199219', '199218', '199217', '199216', '199215', '199214', '199213', '199212', '199211', '199210', '199209', '199208', '199207', '199206', '199205', '199204', '199203', '199201', '199129', '199128', '199127', '199126', '199125', '199124', '199123', '199122', '199121', '199120', '199119', '199118', '199117', '199116', '199115', '199114', '199113', '199112', '199111', '199110', '199109', '199108', '199107', '199106', '199105', '199104', '199103', '199102', '199101', '199029', '199028', '199027', '199026', '199025', '199024', '199023', '199022', '199021', '199020', '199019', '199018', '199017', '199016', '199015', '199014', '199012', '199011', '199010', '199009', '199008', '199007', '199006', '199005', '199004', '199003', '199002', '199001', '198933', '198932', '198931', '198930', '198929', '198928', '198927', '198926', '198925', '198924', '198923', '198922', '198921', '198919', '198918', '198917', '198916', '198915', '198914', '198913', '198912', '198911', '198910', '198909', '198908', '198907', '198906', '198905', '198904', '198903', '198902', '198901', '198827', '198826', '198825', '198824', '198823', '198822', '198820', '198819', '198818', '198817', '198816', '198815', '198814', '198812', '198811', '198810', '198809', '198808', '198807', '198806', '198805', '198804', '198803', '198802', '198801', '198722', '198721', '198720', '198719', '198718', '198717', '198716', '198715', '198714', '198713', '198712', '198711', '198710', '198708', '198707', '198706', '198705', '198704', '198703', '198702', '198701', '198630', '198629', '198628', '198627', '198626', '198625', '198624', '198623', '198622', '198621', '198620', '198619', '198618', '198617', '198616', '198615', '198614', '198612', '198611', '198608', '198607', '198606', '198605', '198604', '198603', '198602', '198601', '198525', '198524', '198523', '198522', '198521', '198520', '198519', '198518', '198517', '198516', '198515', '198514', '198513', '198512', '198511', '198510', '198509', '198508', '198507', '198506', '198505', '198504', '198503', '198502', '198501', '198421', '198420', '198419', '198418', '198417', '198416', '198415', '198414', '198413', '198412', '198411', '198410', '198409', '198408', '198407', '198406', '198405', '198404', '198403', '198402', '198401', '198322', '198321', '198320', '198319', '198318', '198317', '198316', '198315', '198314', '198313', '198312', '198311', '198310', '198309', '198308', '198307', '198306', '198305', '198304', '198303', '198302', '198301', '198224', '198223', '198222', '198221', '198220', '198219', '198218', '198217', '198216', '198215', '198214', '198213', '198212', '198211', '198210', '198209', '198208', '198207', '198206', '198205', '198204', '198203', '198202', '198201', '198124', '198123', '198122', '198121', '198120', '198119', '198118', '198117', '198116', '198115', '198114', '198113', '198112', '198111', '198110', '198109', '198108', '198107', '198106', '198105', '198104', '198103', '198102', '198101', '198023', '198022', '198021', '198020', '198019', '198018', '198017', '198016', '198015', '198014', '198013', '198012', '198011', '198010', '198009', '198008', '198007', '198006', '198005', '198004', '198003', '198002', '198001', '197923', '197922', '197921', '197920', '197919', '197918', '197917', '197916', '197915', '197914', '197913', '197912', '197911', '197910', '197909', '197908', '197907', '197906', '197905', '197904', '197903', '197902', '197901', '197826', '197825', '197824', '197822', '197821', '197820', '197819', '197818', '197817', '197816', '197815', '197814', '197813', '197812', '197811', '197810', '197809', '197808', '197807', '197806', '197805', '197804', '197803', '197802', '197801', '197718', '197717', '197716', '197715', '197714', '197713', '197712', '197711', '197710', '197709', '197708', '197707', '197706', '197705', '197704', '197703', '197702', '197701', '197624', '197623', '197622', '197621', '197620', '197619', '197618', '197617', '197616', '197615', '197614', '197613', '197612', '197611', '197610', '197609', '197608', '197607', '197606', '197605', '197604', '197603', '197602', '197601', '197520', '197519', '197518', '197517', '197516', '197515', '197514', '197513', '197512', '197511', '197510', '197509', '197508', '197507', '197505', '197504', '197503', '197502', '197501', '197429', '197428', '197427', '197426', '197425', '197424', '197423', '197422', '197421', '197420', '197419', '197418', '197417', '197416', '197415', '197414', '197413', '197412', '197411', '197410', '197409', '197408', '197407', '197406', '197405', '197404', '197403', '197402', '197401', '197322', '197321', '197320', '197318', '197317', '197316', '197315', '197314', '197313', '197312', '197311', '197310', '197309', '197308', '197307', '197306', '197305', '197304', '197303', '197302', '197301', '197222', '197221', '197220', '197219', '197218', '197217', '197216', '197215', '197214', '197213', '197212', '197211', '197210', '197209', '197208', '197207', '197206', '197205', '197204', '197203', '197202', '197201', '197130', '197129', '197128', '197126', '197125', '197124', '197123', '197122', '197121', '197120', '197119', '197118', '197117', '197116', '197115', '197114', '197113', '197112', '197111', '197110', '197109', '197108', '197106', '197105', '197104', '197103', '197102', '197101', '197018', '197017', '197016', '197015', '197014', '197013', '197012', '197011', '197010', '197009', '197008', '197007', '197006', '197005', '197004', '197003', '197002', '197001', '196916', '196914', '196913', '196912', '196911', '196910', '196909', '196908', '196907', '196906', '196905', '196904', '196903', '196901', '196820', '196819', '196818', '196817', '196816', '196815', '196814', '196813', '196812', '196811', '196810', '196809', '196808', '196807', '196806', '196805', '196804', '196803', '196802', '196801', '196722', '196721', '196720', '196719', '196718', '196716', '196715', '196714', '196713', '196712', '196711', '196710', '196709', '196707', '196706', '196705', '196704', '196703', '196702', '196701', '196620', '196619', '196618', '196617', '196616', '196615', '196614', '196613', '196612', '196611', '196610', '196609', '196608', '196607', '196606', '196605', '196604', '196603', '196602', '196601', '196523', '196522', '196521', '196520', '196519', '196518', '196517', '196516', '196515', '196514', '196513', '196512', '196511', '196510', '196509', '196508', '196507', '196506', '196505', '196504', '196503', '196502', '196501', '196431', '196430', '196429', '196428', '196427', '196426', '196425', '196424', '196423', '196422', '196421', '196420', '196419', '196418', '196417', '196416', '196415', '196414', '196413', '196411', '196410', '196409', '196408', '196407', '196406', '196405', '196404', '196403', '196402', '196401', '196315', '196314', '196313', '196312', '196311', '196310', '196309', '196308', '196307', '196306', '196305', '196304', '196303', '196302', '196301', '196222', '196221', '196220', '196219', '196218', '196217', '196216', '196215', '196214', '196213', '196212', '196211', '196210', '196209', '196208', '196207', '196206', '196205', '196203', '196202', '196201', '196130', '196129', '196128', '196127', '196126', '196125', '196124', '196123', '196122', '196121', '196120', '196118', '196116', '196115', '196114', '196113', '196112', '196111', '196110', '196109', '196108', '196107', '196106', '196104', '196103', '196102', '196101', '196028', '196027', '196026', '196025', '196024', '196022', '196019', '196016', '196012', '196011', '196010', '196008', '196007', '196005', '196003', '196002', '196001', '195914', '195913', '195912', '195911', '195910', '195909', '195908', '195907', '195905', '195904', '195903', '195902', '195901', '195835', '195834', '195832', '195831', '195830', '195828', '195827', '195826', '195825', '195822', '195818', '195816', '195814', '195812', '195811', '195810', '195809', '195808', '195807', '195805', '195803', '195801', '195727', '195726', '195725', '195724', '195723', '195722', '195721', '195720', '195719', '195718', '195717', '195716', '195715', '195711', '195710', '195708', '195705', '195704', '195703', '195702', '195701', '195636', '195635', '195634', '195632', '195631', '195629', '195628', '195627', '195626', '195623', '195622', '195621', '195618', '195616', '195613', '195612', '195609', '195606', '195604', '195603', '195602', '195537', '195536', '195533', '195532', '195531', '195530', '195528', '195527', '195526', '195522', '195519', '195515', '195513', '195512', '195511', '195510', '195509', '195507', '195505', '195504', '195503', '195501', '195432', '195430', '195429', '195427', '195426', '195425', '195423', '195421', '195419', '195417', '195415', '195414', '195413', '195411', '195410', '195409', '195404', '195402', '195401', '195334', '195331', '195328', '195326', '195325', '195324', '195323', '195320', '195318', '195317', '195316', '195315', '195314', '195313', '195312', '195310', '195309', '195308', '195305', '195304', '195302', '195301', '195236', '195234', '195233', '195232', '195231', '195230', '195229', '195228', '195227', '195226', '195224', '195223', '195222', '195221', '195220', '195218', '195217', '195216', '195215', '195213', '195210', '195208', '195207', '195206', '195204', '195202', '195201', '195130', '195129', '195127', '195126', '195125', '195124', '195123', '195122', '195121', '195118', '195116', '195112', '195107', '195104', '195103', '195102', '195101', '195042', '195040', '195039', '195038', '195037', '195030', '195028', '195027', '195025', '195024', '195019', '195011', '195007', '195004', '195003', '195002', '194933', '194932', '194931', '194930', '194928', '194927', '194925', '194923', '194922', '194920', '194919', '194918', '194917', '194916', '194912', '194908', '194907', '194906', '194905', '194904', '194902', '194901', '194826', '194825', '194824', '194823', '194822', '194821', '194820', '194819', '194818', '194817', '194816', '194815', '194814', '194813', '194812', '194811', '194810', '194809', '194808', '194807', '194806', '194805', '194804', '194803', '194802', '194801', '194727', '194726', '194725', '194724', '194723', '194722', '194721', '194720', '194719', '194718', '194717', '194716', '194715', '194714', '194713', '194712', '194711', '194710', '194709', '194708', '194707', '194706', '194705', '194704', '194703', '194702', '194701', '194615', '194614', '194613', '194612', '194611', '194610', '194609', '194608', '194607', '194606', '194605', '194604', '194603', '194602', '194601', '194526', '194525', '194524', '194523', '194522', '194521', '194520', '194519', '194518', '194517', '194516', '194515', '194514', '194513', '194512', '194511', '194510', '194509', '194508', '194507', '194506', '194505', '194504', '194503', '194502', '194501']
year_sum=[]

for j in list_year:
    a=0
    for i in number:
        if i[:4]==str(j):
            a+=1
    year_sum.append(a)
print(year_sum)
avg=sum(year_sum)/len(year_sum)
print(avg)
print(sum(year_sum))
from pyecharts import Bar
bar=Bar("每年台风数量")
bar.add("",list_year[::2],year_sum[::2])
bar.add("",list_year[1::2],year_sum[1::2])
bar.show_config()
bar.render()

data2=data2[data2['pressure']>500]
fast=data2[data2['speed']==max(data2['speed'])]
print(fast)
low=data2[data2['pressure']==min(data2['pressure'])]
print(low)

data2=data2[data2['strong']=='超强台风(Super TY)']
data2.drop_duplicates('ename','first',inplace=True)
print(data2)